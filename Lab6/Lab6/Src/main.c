/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * <h2><center>&copy; Copyright (c) 2020 STMicroelectronics.
  * All rights reserved.</center></h2>
  *
  * This software component is licensed by ST under BSD 3-Clause license,
  * the "License"; You may not use this file except in compliance with the
  * License. You may obtain a copy of the License at:
  *                        opensource.org/licenses/BSD-3-Clause
  *
  ******************************************************************************
  */
/* USER CODE END Header */

/* Includes ------------------------------------------------------------------*/
#include "main.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */

/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */

/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */

/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/
DAC_HandleTypeDef hdac1;

TIM_HandleTypeDef htim2;

UART_HandleTypeDef huart1;
DMA_HandleTypeDef hdma_usart1_rx;
DMA_HandleTypeDef hdma_usart1_tx;

/* USER CODE BEGIN PV */

/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_DMA_Init(void);
static void MX_DAC1_Init(void);
static void MX_USART1_UART_Init(void);
static void MX_TIM2_Init(void);
/* USER CODE BEGIN PFP */

//comment out audioArray, change arrSize, comment out array in else, change getAudioData = 1

uint16_t audioArray[7501] = {512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,520,524,524,512,500,496,488,472,460,456,448,440,424,424,428,416,392,380,364,356,344,388,428,456,436,440,480,512,544,552,604,620,628,604,620,644,640,612,568,556,532,512,480,476,480,464,436,428,448,464,464,468,484,512,512,528,548,572,568,564,580,592,596,568,572,576,584,556,548,544,536,516,492,484,472,460,432,424,420,400,376,364,356,340,312,304,308,364,396,428,428,448,484,508,556,580,648,652,664,644,660,668,656,636,588,568,516,492,464,464,456,428,412,408,424,436,444,468,484,504,504,524,540,564,576,576,592,584,584,576,596,592,584,560,548,548,536,520,508,516,504,468,448,448,440,416,396,384,372,360,340,336,324,316,316,364,420,444,448,452,504,524,576,592,652,660,656,636,640,660,636,608,552,540,500,472,448,448,440,416,396,404,432,452,456,480,512,536,536,544,572,592,596,576,580,576,576,552,548,552,544,532,516,528,524,524,512,512,504,488,476,468,464,428,404,380,360,332,288,280,268,300,344,384,400,396,452,492,560,584,640,676,688,688,672,704,688,672,600,572,528,492,456,432,436,404,384,364,388,412,424,448,464,500,508,536,576,604,608,580,600,596,608,584,588,592,588,572,540,544,524,524,496,500,484,472,456,440,428,396,380,336,316,284,280,264,304,360,392,400,392,456,492,556,576,640,676,680,676,676,716,684,660,588,572,524,484,456,444,444,396,376,372,400,420,424,448,472,504,512,552,588,600,588,580,608,600,604,580,600,584,564,548,544,556,524,516,500,512,488,488,476,464,440,412,408,376,356,312,292,280,280,336,380,412,396,420,480,524,584,592,664,660,680,656,684,700,660,620,552,556,492,476,436,444,420,384,380,392,432,424,448,472,504,516,528,576,600,600,580,588,612,596,588,572,588,556,540,528,540,528,492,492,484,496,468,484,472,464,424,412,420,400,372,336,340,324,324,368,424,444,420,428,492,532,568,580,640,644,644,624,656,672,632,592,548,544,492,472,456,468,432,396,404,424,448,436,464,488,512,512,536,572,592,580,568,572,580,576,568,576,568,548,528,536,532,512,496,492,496,488,492,484,484,456,444,432,424,404,376,360,356,340,360,404,428,428,416,468,488,528,540,596,616,608,612,612,652,616,612,572,568,520,500,492,488,476,440,444,440,448,444,468,488,488,488,500,524,536,540,552,556,548,532,536,552,548,540,532,536,528,524,520,520,512,504,512,512,508,488,480,480,468,444,428,416,396,380,368,368,400,412,420,412,428,452,472,508,524,564,560,580,584,604,612,604,600,572,556,528,524,516,508,492,476,468,464,468,476,484,484,480,484,492,500,508,512,516,512,512,512,520,520,520,520,516,516,516,528,532,532,524,524,528,524,524,520,516,512,504,496,488,476,464,456,444,432,420,416,424,424,424,424,432,440,448,472,492,512,512,528,536,548,556,564,572,564,556,552,552,548,544,540,536,528,516,512,512,508,504,500,500,492,488,484,484,484,484,484,488,488,492,496,500,504,508,512,516,520,524,528,532,532,532,532,532,528,528,524,520,516,512,508,500,496,488,480,468,460,448,440,436,436,432,428,428,432,436,448,460,476,492,500,512,528,540,548,556,564,564,560,556,556,556,548,540,532,524,516,512,508,504,496,492,488,484,484,484,484,484,484,484,484,488,492,496,500,500,504,508,512,516,520,524,528,532,536,536,540,540,540,540,536,532,524,516,512,504,492,480,464,452,440,432,428,424,424,424,424,432,444,456,468,484,500,512,520,532,540,548,556,556,556,552,548,544,540,536,532,524,520,516,512,512,508,504,500,496,492,492,488,484,484,484,480,480,480,484,484,488,496,500,508,512,516,524,528,536,540,548,548,548,548,544,540,532,528,516,512,504,492,484,476,468,460,452,444,440,436,436,440,444,448,448,456,460,468,480,492,500,508,516,524,532,536,544,548,544,544,544,540,536,532,524,520,512,512,508,504,500,496,492,488,488,488,488,488,488,488,492,496,496,500,504,508,512,512,512,516,516,516,516,520,516,520,516,516,516,512,512,512,512,508,508,504,500,500,496,492,488,488,480,476,472,468,460,456,456,456,456,456,456,460,464,468,476,484,492,500,508,512,516,524,528,528,528,528,528,524,524,524,524,524,520,520,520,516,516,516,512,512,508,508,504,504,500,496,492,492,492,492,492,492,496,500,504,508,512,512,516,520,524,528,532,532,528,528,524,524,520,516,512,512,508,504,500,496,492,488,484,480,476,472,468,464,460,456,456,460,460,460,464,468,472,476,484,496,504,512,520,524,532,540,540,544,544,544,540,536,536,528,524,520,516,512,512,508,504,500,500,496,500,496,500,500,500,500,504,508,508,512,512,512,512,516,516,516,516,516,516,520,520,520,516,516,512,512,512,512,508,508,500,496,492,488,488,484,480,476,476,472,472,468,468,468,468,468,472,476,476,476,480,484,488,492,500,504,508,512,516,516,524,524,528,524,524,524,520,520,516,516,512,512,512,512,512,508,508,508,508,508,508,508,508,508,512,512,512,512,512,512,512,512,512,512,512,512,508,504,504,504,504,504,500,500,500,500,500,500,500,504,504,504,504,504,508,504,504,504,504,500,500,496,496,492,492,488,488,488,484,480,480,484,484,484,484,488,492,496,500,504,508,512,516,516,520,524,524,528,528,524,524,524,520,520,520,516,516,516,512,512,512,512,512,512,512,508,508,508,504,504,504,500,500,500,500,500,500,500,500,504,504,504,504,508,508,508,508,508,508,508,508,508,508,508,508,508,508,508,504,504,504,504,504,504,504,504,504,500,500,500,500,496,496,496,496,496,496,496,496,500,500,500,500,504,504,504,504,504,504,504,504,504,504,504,504,504,504,504,504,508,508,508,508,508,508,508,508,508,508,508,508,508,508,504,504,500,500,496,496,496,496,492,492,492,492,496,496,496,500,500,500,500,500,500,500,500,500,500,496,496,496,496,496,496,496,496,496,496,496,496,500,500,500,504,504,508,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,516,512,512,512,516,512,512,512,516,516,508,524,512,508,516,516,504,512,512,500,504,504,508,480,516,492,492,508,496,492,508,484,492,504,472,500,476,512,476,484,508,476,512,488,492,516,488,516,516,480,552,508,484,576,444,588,452,528,520,480,532,480,540,468,516,468,556,464,528,488,528,496,488,536,488,516,476,532,480,524,488,512,504,504,504,480,524,484,516,484,508,500,500,496,468,552,448,524,464,512,476,508,500,492,492,492,504,480,500,476,524,476,508,472,516,492,504,496,476,532,480,508,496,520,492,528,488,528,500,520,504,524,488,544,504,516,496,528,512,504,520,492,564,488,544,480,512,508,520,500,504,524,492,504,508,500,488,500,496,460,512,476,504,484,488,488,480,508,500,504,492,504,468,492,500,484,492,524,480,492,496,512,484,504,492,512,504,508,500,504,524,508,512,504,528,508,540,512,524,512,524,508,524,524,516,512,500,516,488,516,492,516,492,504,496,512,512,508,508,500,512,504,508,500,508,508,512,484,500,492,508,480,500,500,512,496,508,488,512,504,492,508,516,512,488,520,496,512,512,508,504,512,496,500,508,504,500,492,516,484,516,500,524,520,520,508,508,544,500,516,508,532,492,508,512,496,512,500,500,492,516,488,504,500,512,512,508,508,504,512,500,504,508,500,508,488,496,492,516,500,500,516,484,516,500,504,480,492,476,488,508,516,516,520,500,492,492,512,496,508,508,504,508,496,512,496,512,500,492,512,508,512,508,508,512,512,512,512,512,500,512,512,508,508,508,516,500,512,492,520,496,512,492,516,504,504,496,496,504,496,504,484,512,496,492,504,496,496,500,512,480,516,496,492,512,492,512,496,500,512,496,496,500,500,496,488,504,504,512,504,512,508,516,512,516,512,512,536,508,512,508,512,520,508,516,516,524,516,508,520,512,512,512,504,512,504,500,492,500,492,492,500,472,500,496,512,492,500,496,500,504,492,504,512,496,492,500,488,496,484,496,484,496,492,496,496,500,508,504,500,508,512,516,516,512,504,536,512,524,512,512,540,484,536,472,532,504,512,520,512,540,488,560,476,552,504,532,500,532,520,520,512,504,520,500,512,484,536,480,508,504,488,520,512,492,488,520,472,492,496,500,480,496,492,472,504,472,484,448,516,456,480,500,492,476,512,500,484,516,512,504,508,544,492,532,528,528,504,536,524,504,536,500,528,496,524,484,516,496,508,480,516,516,492,500,512,508,492,524,484,524,512,504,492,532,512,492,516,516,504,524,512,500,532,516,504,512,540,508,516,516,504,524,508,484,508,516,500,492,500,516,488,500,488,500,488,492,480,480,512,468,488,484,512,464,484,496,468,492,468,468,480,492,484,484,504,492,504,516,492,532,508,536,504,540,528,528,524,528,532,512,524,516,496,524,508,504,496,520,480,512,500,536,484,532,516,512,536,520,524,532,560,492,544,532,528,492,552,488,528,504,500,472,552,436,488,496,476,436,496,432,448,480,412,408,456,460,420,464,460,484,476,512,456,560,512,540,508,608,520,572,532,568,540,556,492,536,532,492,480,520,488,500,484,496,496,516,468,496,536,484,512,492,552,476,556,468,572,492,536,508,548,528,516,552,508,560,520,548,512,572,508,544,484,564,448,544,456,532,424,532,440,460,496,412,484,380,528,284,536,312,476,432,428,416,484,524,388,584,488,552,548,568,556,620,596,536,628,580,532,548,532,508,496,500,444,512,456,452,468,496,460,472,524,480,520,500,540,520,560,520,532,584,512,544,552,544,528,532,548,536,532,532,512,560,512,480,572,452,528,464,496,464,476,452,404,528,332,452,424,348,396,408,432,408,424,472,472,512,484,524,604,548,576,600,644,604,596,612,604,584,532,524,544,496,452,464,480,440,428,448,464,464,460,472,516,516,508,548,556,548,536,564,592,576,552,552,560,556,524,540,556,524,516,508,544,508,492,540,504,508,472,492,500,488,444,464,476,428,408,424,388,372,376,336,428,444,356,432,536,496,460,556,640,564,584,648,656,648,616,616,616,600,528,492,524,508,412,408,460,436,368,408,464,456,440,468,516,532,528,556,588,592,584,580,600,592,572,552,564,556,524,512,516,520,492,484,512,516,496,496,512,528,504,480,500,528,460,456,464,448,400,388,376,332,328,348,460,348,352,500,552,488,444,664,692,584,588,716,760,612,588,656,640,540,460,492,488,424,368,360,424,400,364,376,460,496,464,480,564,616,592,568,620,676,628,572,580,632,576,508,512,544,524,448,452,500,504,456,460,520,536,516,500,536,552,516,500,500,496,464,424,396,372,376,340,284,272,392,488,328,348,520,664,520,464,688,772,676,544,680,760,644,528,540,612,516,404,404,440,424,352,368,400,428,440,448,492,516,580,588,596,612,640,648,600,596,588,580,536,512,508,492,476,460,464,464,472,488,500,512,528,552,584,564,556,560,564,536,500,484,476,452,388,364,352,344,300,268,292,416,472,392,416,548,676,604,568,664,760,720,608,640,676,640,520,484,496,444,384,356,376,364,356,396,428,456,464,536,580,584,600,644,692,640,616,608,624,572,508,496,488,468,420,428,436,444,452,468,504,512,544,568,604,612,612,604,592,580,540,512,480,456,420,408,360,312,296,316,320,276,280,416,528,504,456,544,704,708,640,628,720,716,636,592,592,564,476,448,436,400,332,336,400,408,384,404,496,544,536,560,616,660,640,640,656,636,584,548,560,516,460,424,444,444,408,412,448,496,496,512,548,584,608,616,636,624,600,584,576,540,492,464,444,424,384,364,344,328,316,320,328,312,340,456,564,556,524,572,692,716,668,636,668,664,600,564,548,520,436,408,416,408,356,344,408,452,456,456,524,580,588,592,628,660,640,624,616,600,556,508,504,480,452,412,424,436,436,448,476,520,532,552,572,612,628,628,620,612,596,564,540,512,480,440,416,404,384,364,344,340,328,340,340,336,344,440,568,588,552,540,656,696,688,628,636,636,580,544,524,532,440,392,380,420,396,360,396,452,492,480,524,584,612,604,608,652,652,624,584,572,548,504,476,456,452,416,412,428,456,472,484,520,548,576,584,620,636,628,608,596,588,548,520,488,472,436,408,392,384,376,364,352,344,364,360,344,328,424,568,612,568,520,616,680,696,636,628,628,568,528,512,548,476,400,356,408,428,400,408,448,504,500,528,580,632,620,592,616,648,640,572,532,516,508,468,436,440,436,424,416,460,500,520,524,548,584,608,624,632,640,616,584,552,544,520,484,444,424,412,392,380,368,380,360,340,344,356,356,328,432,584,652,588,520,616,692,720,632,620,616,564,504,472,536,488,408,312,384,440,448,428,452,528,536,556,580,656,652,600,576,608,644,580,504,460,480,468,432,424,440,456,436,460,516,576,572,560,576,612,632,620,620,604,572,512,504,504,488,440,404,400,404,396,376,380,376,356,332,328,332,368,504,608,636,568,548,636,704,720,632,612,560,540,484,488,508,456,380,308,392,444,488,456,480,524,564,600,612,652,624,592,564,588,592,540,472,432,448,448,444,436,452,464,476,508,556,596,592,572,580,612,620,592,556,532,516,512,504,492,472,448,424,424,428,420,408,392,384,376,364,336,316,328,488,612,656,568,532,616,692,740,648,624,544,524,468,480,512,464,392,300,384,452,524,500,496,524,568,612,620,652,624,584,540,548,568,544,484,428,424,448,468,476,476,484,496,524,572,608,608,584,572,584,596,580,540,512,504,500,496,488,476,460,436,424,424,428,428,396,368,364,344,328,280,388,572,672,632,512,576,664,764,688,608,564,516,508,440,500,468,436,324,336,436,516,548,488,516,548,624,628,620,616,576,548,516,536,532,500,444,412,440,468,492,492,500,512,532,568,588,600,572,556,552,568,572,544,524,500,504,492,492,480,464,448,428,436,436,436,400,368,344,336,328,304,392,572,672,648,528,580,672,760,692,584,544,500,500,432,480,452,428,340,344,456,528,572,504,524,556,628,628,604,588,548,524,500,524,524,496,444,424,468,500,512,500,508,528,548,568,576,584,556,532,524,532,548,536,520,508,516,520,528,520,508,492,476,476,464,456,428,416,396,356,344,324,332,316,432,604,692,660,544,600,680,764,672,560,504,460,464,416,464,440,416,348,380,500,572,600,524,544,580,632,624,576,556,512,504,484,512,512,484,456,436,492,512,540,512,512,536,556,580,564,564,532,532,528,540,544,516,508,488,512,516,520,512,500,496,476,476,456,448,424,404,388,360,380,356,344,324,476,664,724,652,520,600,672,732,612,520,472,420,424,400,496,464,424,356,432,572,616,592,512,556,580,600,572,548,540,476,460,480,552,544,480,448,472,544,540,524,512,532,520,520,544,548,556,512,512,532,564,548,516,512,512,516,504,512,512,508,488,468,480,464,468,444,440,428,412,412,404,408,360,348,404,596,712,688,564,524,620,664,648,512,472,408,408,416,476,524,456,416,424,572,624,608,536,524,560,556,568,540,528,472,448,500,560,576,488,456,476,536,548,524,508,492,504,508,556,572,560,528,532,572,580,560,516,508,496,492,492,496,496,472,468,472,484,472,448,440,432,428,412,440,408,360,316,404,652,732,696,504,532,612,672,608,488,460,364,408,408,548,520,464,416,492,640,620,588,496,532,524,532,532,516,500,428,472,544,608,556,488,496,520,548,512,500,488,480,488,512,564,552,536,524,572,596,572,544,524,512,492,488,476,484,456,444,464,480,500,484,496,504,492,468,464,480,464,432,404,392,388,368,464,636,696,624,492,560,616,640,512,452,432,416,440,464,556,500,484,472,596,632,576,512,504,556,520,516,484,512,488,496,524,556,564,496,504,508,548,520,508,492,492,512,524,556,544,564,560,584,568,544,520,508,504,480,472,456,460,464,488,500,500,484,492,512,488,464,416,448,448,420,360,332,380,520,680,672,576,500,584,644,624,500,428,416,436,480,504,516,472,488,548,624,592,520,496,524,552,528,500,464,468,504,544,560,520,512,528,552,536,496,496,496,512,508,516,512,528,540,564,584,560,548,532,536,512,504,472,464,460,468,468,464,476,492,512,512,504,496,488,476,464,452,448,408,368,348,360,504,636,656,544,512,608,664,616,496,468,452,476,480,508,484,456,488,560,604,536,504,512,576,560,524,484,496,512,524,536,512,512,504,540,528,528,496,508,512,524,520,508,512,520,556,552,556,528,540,536,540,512,488,480,480,484,476,480,476,488,488,496,492,488,472,472,472,452,432,420,392,364,364,492,616,612,528,524,628,648,600,512,504,480,496,500,500,456,444,500,548,548,500,512,540,568,540,532,508,520,528,540,516,500,512,520,532,512,512,504,516,512,520,512,512,512,528,544,544,540,536,536,536,524,512,496,488,488,492,492,488,488,484,496,496,476,444,436,440,448,432,380,368,396,508,580,576,524,532,612,636,608,536,520,508,532,520,496,444,452,492,516,504,488,500,536,564,564,536,516,532,564,564,524,496,500,520,524,512,488,484,496,520,524,512,508,520,532,540,536,528,520,528,536,532,516,512,512,512,508,504,492,492,492,496,492,492,492,500,496,500,504,492,464,452,452,464,452,424,412,444,524,548,528,508,552,588,600,576,552,532,544,560,536,496,468,480,492,488,480,496,492,500,512,544,540,536,540,552,544,544,540,524,512,512,508,492,488,496,492,488,500,504,504,512,520,524,524,528,532,528,528,528,512,508,508,504,496,488,488,488,496,500,496,492,492,496,492,488,492,492,484,480,476,472,472,496,512,512,512,516,528,540,540,536,528,532,540,536,524,512,512,508,504,496,488,484,492,500,504,504,512,516,524,532,532,528,528,528,524,516,516,512,508,500,504,504,500,504,508,512,512,516,520,524,520,520,516,516,516,512,508,504,504,500,500,504,500,496,500,500,508,508,512,512,512,516,512,512,512,512,512,512,512,512,512,512,512,508,508,512,512,508,508,508,508,508,508,504,500,504,512,512,512,512,512,512,512,512,512,512,512,508,508,508,504,500,500,504,508,508,512,512,512,512,516,520,520,516,512,512,512,512,512,508,504,504,504,504,504,504,504,508,508,512,512,516,516,516,516,516,516,512,512,508,508,512,512,508,508,508,512,512,512,512,512,508,508,508,512,512,508,504,504,504,508,512,512,512,512,512,516,516,512,512,504,504,504,500,500,500,500,500,504,512,512,512,516,520,520,524,524,520,516,512,512,512,508,504,500,500,500,504,504,504,504,512,512,512,512,512,512,516,516,516,512,508,508,512,512,512,508,508,508,508,508,512,512,512,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,508,508,508,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,508,508,508,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,508,512,512,512,512,512,512,516,512,516,516,512,504,504,508,516,516,512,508,504,508,508,512,512,508,508,508,512,516,520,516,512,512,512,516,516,512,512,508,508,508,508,508,508,508,512,512,512,512,512,516,516,512,512,512,512,512,512,508,508,512,512,508,508,512,512,512,512,516,512,512,512,512,512,508,504,504,512,508,508,512,528,548,536,512,492,488,500,516,520,512,504,512,520,516,508,500,504,512,516,516,512,512,508,508,508,512,508,508,512,512,512,512,504,512,524,520,512,504,504,508,512,512,512,508,508,508,512,516,540,540,524,504,500,500,508,512,512,504,496,492,492,500,504,504,504,504,508,512,516,532,544,540,520,512,504,512,520,512,504,492,492,496,508,512,504,500,500,504,516,512,512,504,508,524,520,508,500,504,512,512,496,496,500,504,500,500,500,508,508,508,500,512,516,516,508,508,512,508,512,504,512,504,504,496,508,508,504,500,512,508,500,508,508,508,504,500,516,504,512,512,496,508,516,508,512,512,508,512,516,512,504,508,512,512,504,512,500,504,508,504,516,512,512,508,512,520,516,516,508,512,512,524,504,500,504,512,512,508,504,496,512,512,512,500,512,512,512,512,516,508,512,516,520,512,500,512,512,516,508,512,508,512,508,512,508,508,512,508,512,508,512,512,512,512,512,520,512,508,508,520,512,512,504,508,504,512,512,504,512,500,512,516,512,512,508,512,512,512,512,496,512,516,512,496,512,508,508,512,504,508,508,520,508,508,508,512,512,512,512,504,512,516,508,516,512,504,516,512,512,508,508,508,512,512,508,504,516,512,508,512,508,504,512,512,508,508,512,508,516,512,512,512,512,512,504,508,508,504,512,512,508,508,512,512,512,512,512,512,516,512,512,508,508,512,508,504,512,508,504,512,512,512,512,512,512,512,512,508,508,512,512,512,508,512,512,512,508,512,512,520,512,508,508,512,512,508,512,508,512,512,512,508,516,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,512,512,508,512,512,512,512,512,508,512,512,508,508,512,512,504,508,508,512,512,508,508,512,516,512,512,512,512,512,508,512,508,512,508,512,512,512,512,512,512,512,516,512,512,512,512,512,512,508,512,512,512,512,512,512,512,512,512,516,512,512,512,512,512,512,512,512,512,508,512,512,512,512,512,512,512,512,512,512,512,508,512,512,512,512,512,512,512,508,508,508,508,512,508,512,512,512,512,512,512,512,512,508,508,508,508,508,508,508,512,512,512,512,512,512,512,512,512,508,508,508,508,508,508,508,508,508,512,512,512,512,512,512,508,508,508,508,508,508,508,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,508,512,512,512,512,512,512,512,508,516,528,516,512,512,512,508,512,508,512,512,512,508,512,512,512,512,512,512,512,508,512,512,508,512,512,512,512,512,512,508,512,512,512,512,508,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,508,508,512,508,512,512,512,512,512,512,512,512,512,512,508,508,512,512,512,508,508,512,512,512,512,512,512,512,512,512,508,508,512,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,512,512,512,512,512,512,512,512,512,512,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,508,508,508,512,512,512,512,512,512,512,512,512,512,512,508,508,508,508,508,508,508,508,508,512,512,512,508,508,512,512,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,508,512,512,512,512,512,512,512,512,512,512,512,512,512,512,516,512,532,556,516,524,516,508,512,504,500,504,500,496,508,504,496,500,504,500,504,512,508,516,512,512,512,520,512,516,512,512,508,512,508,512,508,504,512,504,500,492,540,532,512,524,520,512,516,512,512,516,500,504,512,500,488,512,500,492,500,508,496,512,508,508,516,512,508,512,516,504,512,512,512,508,512,508,516,508,508,512,508,512,504,520,508,512,512,512,512,508,516,512,512,508,512,512,508,504,512,508,504,512,508,512,512,508,512,512,508,512,512,504,512,512,508,508,512,504,512,508,504,512,512,500,512,512,504,512,512,512,512,512,512,512,512,512,512,512,512,512,512,512,508,512,512,508,512,512,508,512,512,508,508,508,512,508,504,508,512,508,508,512,512,512,512,508,512,512,508,512,512,504,512,512,504,508,512,508,508,508,512,512,508,508,512,504,512,512,512,508,512,512,512,512,508,512,512,508,508,512,508,512,512,512,512,512,512,512,512,512,512,508,508,508,500,504,504,496,500,496,500,504,504,508,516,512,520,532,532,536,544,544,544,544,544,544,536,532,528,520,512,512,504,500,496,496,496,492,496,500,496,496,500,500,492,492,500,488,488,480,460,468,452,444,488,456,456,508,488,476,528,528,520,556,560,564,576,568,584,576,552,560,552,512,520,512,488,484,488,476,472,472,480,488,484,500,512,508,516,532,532,544,540,556,548,544,560,548,528,544,540,516,520,516,512,508,500,504,504,488,504,500,488,500,504,492,508,508,508,512,508,512,516,508,512,520,512,512,520,512,512,512,508,496,496,492,480,468,456,472,424,444,460,448,440,472,488,468,504,516,528,524,564,568,568,580,596,584,568,580,560,536,528,528,500,488,488,484,464,468,476,472,472,488,496,492,512,528,516,528,552,544,540,556,556,544,548,552,540,532,532,528,516,512,512,504,500,504,500,496,496,504,500,496,504,504,500,508,512,504,508,512,512,508,508,504,500,496,488,484,472,464,452,448,460,460,444,484,484,472,504,520,512,532,556,552,564,576,580,568,572,572,556,536,536,524,504,500,500,480,476,484,476,472,484,492,488,496,512,520,512,532,540,532,540,548,544,544,552,544,544,540,544,536,528,528,524,516,516,516,508,504,508,504,496,500,500,492,496,500,496,496,504,500,500,508,504,504,508,512,500,508,500,496,492,480,476,456,452,460,468,436,468,484,456,484,512,496,508,548,540,548,568,576,564,572,576,564,544,544,540,512,508,512,492,480,492,480,468,480,488,480,492,504,508,512,520,528,528,536,540,544,540,548,548,540,544,540,532,532,532,524,520,516,512,512,508,508,504,500,496,496,492,492,492,492,492,492,496,500,500,508,508,508,512,512,512,512,504,512,504,488,492,480,460,464,460,460,456,464,472,472,476,500,508,508,532,544,548,564,580,572,576,584,572,560,556,544,524,516,512,500,492,492,484,480,484,484,484,492,496,500,508,512,520,524,532,532,540,540,544,544,544,544,540,536,536,532,528,524,520,516,512,508,508,500,496,492,492,484,484,488,484,484,492,488,492,496,500,500,496,512,500,500,508,496,488,492,476,464,472,472,464,468,476,480,484,496,508,512,520,536,544,548,564,568,564,568,568,552,548,540,528,516,512,504,496,500,492,484,496,496,488,504,504,500,516,516,512,524,528,524,532,536,532,536,540,536,536,536,536,532,528,528,524,512,516,512,500,508,500,488,496,492,484,488,492,484,492,492,492,500,500,496,504,504,500,504,496,492,492,480,468,472,468,472,468,476,484,488,492,512,512,520,540,544,548,564,572,560,568,564,552,544,540,524,516,512,504,500,496,488,500,492,492,508,508,500,516,520,512,524,532,516,528,540,524,524,540,528,524,536,532,524,532,532,520,524,528,516,512,520,512,504,508,504,492,496,492,484,488,488,484,484,488,484,484,484,484,480,480,480,464,472,472,448,476,488,452,488,512,480,504,548,512,524,576,548,540,588,572,544,572,564,528,536,536,512,500,508,500,492,488,496,496,488,508,512,504,512,532,520,528,544,536,532,540,536,524,532,532,520,524,524,516,512,520,516,512,516,516,512,512,512,512,508,512,508,504,504,504,500,496,500,500,492,496,492,488,488,484,484,480,472,472,468,448,468,460,456,480,480,476,508,512,508,536,544,540,564,576,564,576,584,560,560,560,536,524,528,512,500,500,500,492,488,496,500,496,504,512,512,516,528,524,524,536,532,524,532,528,520,528,528,516,520,524,516,516,520,512,512,520,516,512,516,512,508,512,512,508,504,504,504,508,512,504,492,496,504,492,488,500,492,480,492,484,460,468,468,448,452,464,456,468,484,492,504,516,516,532,552,548,564,576,572,572,580,564,552,556,536,520,524,516,500,508,512,496,500,512,504,504,520,520,516,524,528,520,524,532,516,520,524,516,512,520,520,516,520,516,520,520,516,520,524,516,516,520,512,504,512,504,492,500,500,492,496,500,492,500,500,496,500,504,492,492,496,488,480,480,476,460,460,460,452,452,468,472,476,492,504,512,520,536,544,548,564,568,564,568,568,552,552,552,536,532,532,524,516,516,516,512,508,512,512,512,516,520,516,516,524,516,512,520,516,512,524,524,524,528,528,524,528,528,524,524,528,524,516,516,512,512,504,500,496,488,488,488,488,484,488,492,484,488,492,488,484,488,484,476,476,476,468,464,468,464,468,476,476,480,488,496,500,512,520,524,532,544,548,548,552,552,552,552,548,548,544,540,536,536,532,532,524,528,524,524,524,524,520,520,516,516,512,512,512,512,516,516,516,524,520,516,524,520,516,524,528,520,520,524,516,512,512,508,504,500,496,492,492,488,484,480,484,480,472,472,472,472,472,480,476,472,476,480,480,480,484,492,492,496,500,504,504,508,512,516,520,524,528,532,532,532,536,536,532,540,544,540,540,544,540,536,536,540,532,532,536,536,532,532,528,524,524,524,516,520,520,520,520,520,516,516,516,512,512,516,512,512,512,516,516,512,504,512,512,504,504,512,508,492,488,488,484,476,476,476,480,476,472,472,472,464,464,472,476,480,488,492,496,504,504,508,512,512,520,524,528,528,532,536,540,540,544,536,536,536,536,536,532,536,536,532,524,528,528,524,524,524,524,528,532,524,520,528,528,520,520,524,520,516,516,512,512,512,508,504,508,508,500,500,504,504,504,496,496,504,496,496,500,504,500,496,496,488,484,488,488,476,472,476,476,476,476,472,476,484,484,488,492,500,508,512,516,520,524,532,532,532,536,540,536,536,536,536,536,536,532,528,528,532,528,524,524,524,524,528,524,520,524,528,524,524,524,524,520,520,520,516,516,520,516,512,516,516,512,512,512,512,512,512,508,500,500,504,500,496,496,496,492,496,500,500,496,488,488,492,496,492,488,488,492,492,492,492,496,496,500,500,500,504,512,508,512,516,520,524,528,524,524,528,528,528,532,532,532,532,532,528,524,528,528,528,532,532,528,528,528,528,524,520,520,524,520,520,520,516,512,516,516,512,512,512,508,512,520,504,516,504,524,512,508,516,508,496,508,508,508,512,488,508,500,496,496,492,496,480,484,480,492,496,492,500,500,492,492,500,496,496,500,512,512,504,508,512,512,516,520,524,520,528,532,528,524,528,528,528,524,520,520,520,524,524,520,524,528,524,520,524,524,516,516,520,512,512,520,516,512,512,512,508,512,516,512,512,512,512,512,512,512,512,512,512,512,508,508,512,512,508,504,504,500,500,500,500,500,500,500,496,500,496,496,500,504,504,504,508,504,500,500,508,516,524,524,520,524,524,524,520,524,524,520,524,520,520,524,524,528,524,528,516,524,512,528,512,512,508,532,504,536,504,508,560,484,596,424,568,520,488,568,448,540,496,536,512,500,520,508,508,516,512,512};
uint8_t audioInput[15002]; //need 8 bit here because hal_uart_receive takes uint8_t* as input
uint16_t audioConverted[7501];
int arrSize = 7501;
//int arrSize = 2000;

int counter;
int timerFlag;
int start = 0;	
int getAudioData = 0; //used once at the beginning to get matlab data

/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */

/* USER CODE END 0 */

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{
  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */
  

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_DMA_Init();
  MX_DAC1_Init();
  MX_USART1_UART_Init();
  MX_TIM2_Init();
  /* USER CODE BEGIN 2 */
		
		HAL_DAC_Start(&hdac1, DAC_CHANNEL_1);
		HAL_DAC_Start(&hdac1, DAC_CHANNEL_2);
		HAL_TIM_Base_Start_IT(&htim2);
		
  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
    
	//get audio data from matlab via serial port	
	if (getAudioData){
		if (HAL_UART_Receive(&huart1, audioInput, arrSize*2, 3000) != HAL_OK){
			HAL_GPIO_WritePin(GPIOB, GPIO_PIN_14, GPIO_PIN_SET); //while transmitting, turn on LED
		}
		else {
			getAudioData = 0;
			HAL_GPIO_WritePin(GPIOB, GPIO_PIN_14, GPIO_PIN_RESET); //if done transmitting, turn off LED
			int i;
			for (i=0; i<arrSize; i++){
				audioConverted[i] = ((uint16_t)audioInput[i+1] << 8) || audioInput[i];//leastSig = i, mostSig = i+1
			}
		}
	}
	
	//start if user button is pressed
	if (!HAL_GPIO_ReadPin(GPIOC, GPIO_PIN_13)){
		start = 1;
	}
	
	while(start && !getAudioData) {
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_14, GPIO_PIN_SET); //turn on LED
		if (timerFlag == 1) {
			timerFlag = 0;
			
			//stop transmitting
			if (counter == arrSize) {
				
				HAL_GPIO_WritePin(GPIOB, GPIO_PIN_14, GPIO_PIN_RESET); //turn off LED
				counter = 0;
				start = 0;
				
				//set output to 0V
				HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_1, DAC_ALIGN_12B_R, 0);
				HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_2, DAC_ALIGN_12B_R, 0);
				break;
			}
			
			//continue transmitting
			else {
				//HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_1, DAC_ALIGN_12B_R, 5*audioConverted[counter]);
				//HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_2, DAC_ALIGN_12B_R, 5*audioConverted[counter]);
				HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_1, DAC_ALIGN_12B_R, audioArray[counter]);
				HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_2, DAC_ALIGN_12B_R, audioArray[counter]);
				
				counter++;
			}
		}
	}

	
}
				
			
  /* USER CODE END 3 */
}


/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};
  RCC_PeriphCLKInitTypeDef PeriphClkInit = {0};

  /** Initializes the CPU, AHB and APB busses clocks 
  */
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_MSI;
  RCC_OscInitStruct.MSIState = RCC_MSI_ON;
  RCC_OscInitStruct.MSICalibrationValue = 0;
  RCC_OscInitStruct.MSIClockRange = RCC_MSIRANGE_6;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;
  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_MSI;
  RCC_OscInitStruct.PLL.PLLM = 1;
  RCC_OscInitStruct.PLL.PLLN = 40;
  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV7;
  RCC_OscInitStruct.PLL.PLLQ = RCC_PLLQ_DIV2;
  RCC_OscInitStruct.PLL.PLLR = RCC_PLLR_DIV2;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }
  /** Initializes the CPU, AHB and APB busses clocks 
  */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_4) != HAL_OK)
  {
    Error_Handler();
  }
  PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_USART1;
  PeriphClkInit.Usart1ClockSelection = RCC_USART1CLKSOURCE_PCLK2;
  if (HAL_RCCEx_PeriphCLKConfig(&PeriphClkInit) != HAL_OK)
  {
    Error_Handler();
  }
  /** Configure the main internal regulator output voltage 
  */
  if (HAL_PWREx_ControlVoltageScaling(PWR_REGULATOR_VOLTAGE_SCALE1) != HAL_OK)
  {
    Error_Handler();
  }
}

/**
  * @brief DAC1 Initialization Function
  * @param None
  * @retval None
  */
static void MX_DAC1_Init(void)
{

  /* USER CODE BEGIN DAC1_Init 0 */

  /* USER CODE END DAC1_Init 0 */

  DAC_ChannelConfTypeDef sConfig = {0};

  /* USER CODE BEGIN DAC1_Init 1 */

  /* USER CODE END DAC1_Init 1 */
  /** DAC Initialization 
  */
  hdac1.Instance = DAC1;
  if (HAL_DAC_Init(&hdac1) != HAL_OK)
  {
    Error_Handler();
  }
  /** DAC channel OUT1 config 
  */
  sConfig.DAC_SampleAndHold = DAC_SAMPLEANDHOLD_DISABLE;
  sConfig.DAC_Trigger = DAC_TRIGGER_NONE;
  sConfig.DAC_OutputBuffer = DAC_OUTPUTBUFFER_ENABLE;
  sConfig.DAC_ConnectOnChipPeripheral = DAC_CHIPCONNECT_DISABLE;
  sConfig.DAC_UserTrimming = DAC_TRIMMING_FACTORY;
  if (HAL_DAC_ConfigChannel(&hdac1, &sConfig, DAC_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
  /** DAC channel OUT2 config 
  */
  sConfig.DAC_ConnectOnChipPeripheral = DAC_CHIPCONNECT_DISABLE;
  if (HAL_DAC_ConfigChannel(&hdac1, &sConfig, DAC_CHANNEL_2) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN DAC1_Init 2 */

  /* USER CODE END DAC1_Init 2 */

}

/**
  * @brief TIM2 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM2_Init(void)
{

  /* USER CODE BEGIN TIM2_Init 0 */

  /* USER CODE END TIM2_Init 0 */

  TIM_ClockConfigTypeDef sClockSourceConfig = {0};
  TIM_MasterConfigTypeDef sMasterConfig = {0};

  /* USER CODE BEGIN TIM2_Init 1 */

  /* USER CODE END TIM2_Init 1 */
  htim2.Instance = TIM2;
	
	/*
	* The prescaler value is used in conjunction with the clock speed to set an overflow ~ Brandon
	*/
	//the prescaler is one less than its actual value, so setting it to 0 is the equivalent of dividing input frequency by 1
  htim2.Init.Prescaler = 3; 
  htim2.Init.CounterMode = TIM_COUNTERMODE_UP;
  
	//This clock is set at 80MHz. The Audio is sampled at 8000 samples / second. 
	//Thus, we need this to match the rate of the sampled audio. 
	//80MHz / (period*prescaler) period*prescaler = 10000
	//80MHz / 10 000 = 8 000Hz
	htim2.Init.Period = 2500;
  htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim2) != HAL_OK)
  {
    Error_Handler();
  }
	//HAL_TIM_Base_Start_IT(&htim2);
	
  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;
  if (HAL_TIM_ConfigClockSource(&htim2, &sClockSourceConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim2, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM2_Init 2 */
	HAL_NVIC_SetPriority(TIM2_IRQn, 0, 0);
	HAL_NVIC_EnableIRQ(TIM2_IRQn);

  /* USER CODE END TIM2_Init 2 */

}

/**
  * @brief USART1 Initialization Function
  * @param None
  * @retval None
  */
static void MX_USART1_UART_Init(void)
{

  /* USER CODE BEGIN USART1_Init 0 */

  /* USER CODE END USART1_Init 0 */

  /* USER CODE BEGIN USART1_Init 1 */

  /* USER CODE END USART1_Init 1 */
  huart1.Instance = USART1;
  huart1.Init.BaudRate = 115200;
  huart1.Init.WordLength = UART_WORDLENGTH_8B;
  huart1.Init.StopBits = UART_STOPBITS_1;
  huart1.Init.Parity = UART_PARITY_NONE;
  huart1.Init.Mode = UART_MODE_TX_RX;
  huart1.Init.HwFlowCtl = UART_HWCONTROL_NONE;
  huart1.Init.OverSampling = UART_OVERSAMPLING_16;
  huart1.Init.OneBitSampling = UART_ONE_BIT_SAMPLE_DISABLE;
  huart1.AdvancedInit.AdvFeatureInit = UART_ADVFEATURE_NO_INIT;
  if (HAL_UART_Init(&huart1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN USART1_Init 2 */

  /* USER CODE END USART1_Init 2 */

}

/** 
  * Enable DMA controller clock
  */
static void MX_DMA_Init(void) 
{
  /* DMA controller clock enable */
  __HAL_RCC_DMA1_CLK_ENABLE();

  /* DMA interrupt init */
  /* DMA1_Channel4_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(DMA1_Channel4_IRQn, 0, 0);
  HAL_NVIC_EnableIRQ(DMA1_Channel4_IRQn);
  /* DMA1_Channel5_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(DMA1_Channel5_IRQn, 0, 0);
  HAL_NVIC_EnableIRQ(DMA1_Channel5_IRQn);

}

/**
  * @brief GPIO Initialization Function
  * @param None
  * @retval None
  */
static void MX_GPIO_Init(void)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};

  /* GPIO Ports Clock Enable */
  __HAL_RCC_GPIOC_CLK_ENABLE();
  __HAL_RCC_GPIOA_CLK_ENABLE();
  __HAL_RCC_GPIOB_CLK_ENABLE();

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(LED2_GPIO_Port, LED2_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pin : PC13 */
  GPIO_InitStruct.Pin = GPIO_PIN_13;
  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);

  /*Configure GPIO pin : LED2_Pin */
  GPIO_InitStruct.Pin = LED2_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(LED2_GPIO_Port, &GPIO_InitStruct);

}

/* USER CODE BEGIN 4 */

/* USER CODE END 4 */

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */

  /* USER CODE END Error_Handler_Debug */
}

#ifdef  USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(char *file, uint32_t line)
{ 
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
     tex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */
}
#endif /* USE_FULL_ASSERT */

/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
